<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="utf-8" />
  <title>Создать мероприятие</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 110vh;
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }

    .container {
      text-align: center;
      margin: 0 auto;
      max-width: 600px;
      width: 100%;
    }

    form {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      text-align: left;
    }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    select {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    input[type="submit"] {
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 16px;
      cursor: pointer;
    }

    input[type="submit"]:hover {
      background-color: #0056b3;
    }

    .checkbox-container {
      text-align: left;
    }

    .checkbox-container label {
      display: block;
      margin-bottom: 6px;
      font-weight: normal;
    }

    h1 {
      margin-top: 100px;
      margin-bottom: 20px;
    }

    /* Адаптация для мобильных устройств */
    @media (max-width: 768px) {
      h1 {
        margin-top: 50px;
      }

      form {
        padding: 15px;
      }

      input[type="submit"] {
        font-size: 14px;
      }
    }

    /* Адаптация для десктопов */
    @media (min-width: 769px) {
      body {
        padding: 20px;
      }

      .container {
        max-width: 800px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Создание события</h1>
    <form method="POST">
      {% csrf_token %}
      <form action="/create-event" method="POST" onsubmit="validateForm(event)">
        <label for="type">Тип события:</label>
        <select id="type" name="type">
          <option value="">Выберите тип события</option>
          <option value="Индивидуальная встреча">Индивидуальная встреча</option>
          <option value="Круглый стол">Круглый стол</option>
          <option value="Отраслевое мероприятие">Отраслевое мероприятие</option>
          <option value="Внешняя открытая встреча">Внешняя открытая встреча</option>
        </select>

        <label for="theme">Тема мероприятия:</label>
        <input id="theme" name="theme" type="text" placeholder="Введите тему мероприятия" />

        <label for="tags">Выберите интересы:</label>
        <div class="checkbox-container">
          <label><input type="checkbox" name="tags[]" value="IT" /> IT</label>
          <label><input type="checkbox" name="tags[]" value="Auto" /> Auto</label>
          <label><input type="checkbox" name="tags[]" value="Sport" /> Sport</label>
          <label><input type="checkbox" name="tags[]" value="Business" /> Business</label>
        </div>

        <label for="city">Город:</label>
        <select id="city" name="city" onchange="updateLocationField()">
          <option value="">Выберите город</option>
          <option value="Москва">Москва</option>
          <option value="Санкт-Петербург">Санкт-Петербург</option>
          <option value="Новосибирск">Новосибирск</option>
          <option value="Дубаи">Дубаи</option>
          <option value="Китай">Китай</option>
        </select>

        <label for="location">Место проведения:</label>
        <select id="location" name="location">
          <option value="">Выберите место проведения</option>
        </select>

        <label for="date">Дата:</label>
        <input id="date" name="date" type="date" />

        <label for="start-time">Время начала:</label>
        <input id="start-time" name="start-time" type="time" value="00:00" />

        <label for="end-time">Время окончания:</label>
        <input id="end-time" name="end-time" type="time" value="00:00" />

        <label for="min-participants">Минимальное количество участников:</label>
        <input id="min-participants" name="min-participants" type="number" min="2" />

        <label for="max-participants">Максимальное количество участников:</label>
        <input id="max-participants" name="max-participants" type="number" min="2" />

        <input type="submit" value="Создать" />
      </form>
    </form>
  </div>

  <script>
    function updateLocationField() {
      const city = document.getElementById('city').value;
      const locationSelect = document.getElementById('location');
      locationSelect.innerHTML = '';

      if (city === "") {
        locationSelect.innerHTML += '<option value="">Выберите место проведения</option>';
        return;
      }

      if (city === 'Новосибирск') {
        locationSelect.innerHTML += 
          '<option value="">Выберите место проведения</option>' +
          '<option value="Переговорная комната 1">Переговорная комната 1</option>' +
          '<option value="Переговорная комната 2">Переговорная комната 2</option>' +
          '<option value="Переговорная комната 3">Переговорная комната 3</option>' +
          '<option value="Конференц-зал">Конференц-зал</option>';
      } else {
        locationSelect.innerHTML += 
          '<option value="">Выберите место проведения</option>' +
          '<option value="Переговорная комната A">Переговорная комната A</option>' +
          '<option value="Переговорная комната B">Переговорная комната B</option>';
      }
    }

    function checkDuration() {
      const startTime = document.getElementById('start-time').value;
      const endTime = document.getElementById('end-time').value;

      if (!startTime || !endTime) {
        return false;
      }

      const start = new Date(`1970-01-01T${startTime}:00`);
      const end = new Date(`1970-01-01T${endTime}:00`);
      const duration = (end - start) / (1000 * 60 * 60);

      if (duration > 3) {
        alert('Продолжительность мероприятия не может превышать 3 часа.');
        return false;
      }

      return true;
    }

    async function checkAvailability() {
      const startTime = document.getElementById('start-time').value;
      const endTime = document.getElementById('end-time').value;

      const response = await fetch('/check-availability', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ startTime, endTime })
      });

      const result = await response.json();
      return result.available;
    }

    async function validateForm(event) {
      event.preventDefault();

      const type = document.getElementById('type').value;
      const theme = document.getElementById('theme').value;
      const tagsChecked = document.querySelectorAll('input[name="tags[]"]:checked').length;
      const city = document.getElementById('city').value;
      const date = document.getElementById('date').value;
      const startTime = document.getElementById('start-time').value;
      const endTime = document.getElementById('end-time').value;
      const min_participants = document.getElementById('min-participants').value;
      const max_participants = document.getElementById('max-participants').value;

      if (!type || !theme || !tagsChecked || !city || !date || !startTime || !endTime || !min_participants || !max_participants) {
        alert('Пожалуйста, заполните все поля.');
        return;
      }

      if (!checkDuration()) {
        return;
      }

      document.body.style.cursor = 'wait';
      const available = await checkAvailability();
      document.body.style.cursor = 'default';

      if (!available) {
        alert('Выбранное время уже занято. Пожалуйста, выберите другое время.');
        return;
      }

      event.target.submit();
    }
  </script>
</body>

</html>
